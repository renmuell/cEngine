{"version":3,"sources":["cEngine.filter.js"],"names":["e","t","n","r","s","o","u","a","require","i","Error","f","exports","call","length",1,"module","cEngine","extend","version","create","config","filter","cEnginePlugin","list","filters","postStep","context","width","height","allOff","run","imageData","getImageData","Shader","factor","CustomFilter","Convolver","Convolve","data","divisor","offset","setImageData","res","len","this","canvasWidth","matrix","m","concat","reduce","b","oldData","newImageData","createImageData","newData","w","these","j","putImageData","noise2","g","Math","random","rgbToBrg","rgbToRbg","rgbToGbr","rgbToGrB","rgbToBgr","transparent","gradient","l","greyscale","avg","sepia","sepia2","gammaCorrect","pow","negative","noGreen","maxGreen","onlyGreen","maxAllButGreen","brightness","noise","rand","randomClear","undefined","smean_removal_sharpen","name","sharpen","blur","emboss","emboss_subtle","edge_detect","edge_detect_2"],"mappings":"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","file":"cEngine.filter-min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\n/*global cEngine */\n// influence and some code by http://www.phpied.com/pixel-manipulation-in-canvas/\n// http://www.phpied.com/canvas-pixels-2-convolution-matrix/\n\n(function (cEngine) {\n\n  cEngine.extend('filter', {\n    version: '0.0.3',\n    create: function create(config) {\n\n      var filter = {\n        cEnginePlugin: true,\n        list: config.filters || [],\n\n        postStep: function postStep(context, width, height) {\n          if (filter.list.length == 0) {\n            return;\n          }\n\n          var allOff = true,\n              i;\n\n          for (i = 0; i < filter.list.length; i++) {\n            if (typeof filter.list[i].run === 'undefined' || filter.list[i].run) {\n              allOff = false;\n              break;\n            }\n          }\n\n          if (allOff) {\n            return;\n          }\n\n          var imageData = filter.getImageData(context, width, height);\n\n          for (i = 0; i < filter.list.length; i++) {\n            if (typeof filter.list[i].run !== 'undefined' && !filter.list[i].run) {\n              continue;\n            }\n\n            if (filter.list[i].Shader) {\n              imageData = filter.Shader(imageData, filter.list[i].Shader, filter.list[i].factor);\n            } else if (filter.list[i].CustomFilter) {\n              imageData = filter.list[i].CustomFilter(imageData);\n            } else if (filter.list[i].Convolver) {\n              imageData = filter.Convolve(context, imageData, width, filter.list[i].Convolver.data, filter.list[i].Convolver.divisor, filter.list[i].Convolver.offset);\n            }\n          }\n\n          filter.setImageData(context, imageData);\n        },\n        Shader: function Shader(imageData, filter, factor) {\n          var data = imageData.data;\n          var res = [];\n          var len = data.length;\n          for (var i = 0; i < len; i += 4) {\n            res = filter.call(this, data[i], data[i + 1], data[i + 2], data[i + 3], factor, i, len);\n\n            data[i] = res[0]; // r\n            data[i + 1] = res[1]; // g\n            data[i + 2] = res[2]; // b\n            data[i + 3] = res[3]; // a\n          }\n\n          return imageData;\n        },\n        Convolve: function Convolve(context, imageData, canvasWidth, matrix, divisor, offset) {\n          var m = [].concat(matrix[0], matrix[1], matrix[2]); // flatten\n          if (!divisor) {\n            divisor = m.reduce(function (a, b) {\n              return a + b;\n            }) || 1; // sum\n          }\n\n          var oldData = imageData.data;\n          var newImageData = context.createImageData(imageData);\n          var newData = newImageData.data;\n\n          var len = newData.length;\n          var res = 0;\n\n          var w = canvasWidth;\n          for (var i = 0; i < len; i++) {\n\n            if ((i + 1) % 4 === 0) {\n              newData[i] = oldData[i];\n              continue;\n            }\n\n            res = 0;\n            var these = [oldData[i - w * 4 - 4] || oldData[i], oldData[i - w * 4] || oldData[i], oldData[i - w * 4 + 4] || oldData[i], oldData[i - 4] || oldData[i], oldData[i], oldData[i + 4] || oldData[i], oldData[i + w * 4 - 4] || oldData[i], oldData[i + w * 4] || oldData[i], oldData[i + w * 4 + 4] || oldData[i]];\n            for (var j = 0; j < 9; j++) {\n              res += these[j] * m[j];\n            }\n            res /= divisor;\n            if (offset) {\n              res += offset;\n            }\n            newData[i] = res;\n          }\n\n          return newImageData;\n        },\n        getImageData: function getImageData(context, width, height) {\n          return context.getImageData(0, 0, width, height);\n        },\n        setImageData: function setImageData(context, data) {\n          return context.putImageData(data, 0, 0);\n        }\n      };\n\n      return filter;\n    },\n\n    Shader: {\n      noise2: function noise2(r, g, b, a) {\n        if (r != 0 && g != 0 && b != 0 && a != 0) {\n          //var avg = 0.3  * r + 0.59 * g + 0.11 * b;\n          //return [avg, avg, avg, 255];\n          r = Math.random() * 255;\n          g = Math.random() * 255;\n          b = Math.random() * 255;\n        }\n        return [r, g, b, a];\n      },\n      rgbToBrg: function rgbToBrg(r, g, b) {\n        return [b, r, g, 255];\n      },\n      rgbToRbg: function rgbToRbg(r, g, b) {\n        return [r, b, g, 255];\n      },\n      rgbToGbr: function rgbToGbr(r, g, b) {\n        return [g, b, r, 255];\n      },\n      rgbToGrB: function rgbToGrB(r, g, b) {\n        return [g, r, b, 255];\n      },\n      rgbToBgr: function rgbToBgr(r, g, b) {\n        return [b, g, r, 255];\n      },\n      transparent: function transparent(r, g, b, a, factor) {\n        // factor: \"value (0-255)\"\n        return [r, g, b, factor];\n      },\n      gradient: function gradient(r, g, b, a, factor, i, l) {\n        // factor: \"value (0-255)\"\n        return [r, g, b, factor + 255 * (l - i) / l];\n      },\n      greyscale: function greyscale(r, g, b) {\n        var avg = 0.3 * r + 0.59 * g + 0.11 * b;\n        return [avg, avg, avg, 255];\n      },\n      sepia: function sepia(r, g, b) {\n        var avg = 0.3 * r + 0.59 * g + 0.11 * b;\n        return [avg + 100, avg + 50, avg, 255];\n      },\n      sepia2: function sepia2(r, g, b) {\n        return [(r * 0.393 + g * 0.769 + b * 0.189) / 1.351, (r * 0.349 + g * 0.686 + b * 0.168) / 1.203, (r * 0.272 + g * 0.534 + b * 0.131) / 2.140, 255];\n      },\n      gammaCorrect: function gammaCorrect(r, g, b, a, factor) {\n        // factor: 'value(2-10), decimal OK'\n        return [Math.pow(r / 255, factor) * 255, Math.pow(g / 255, factor) * 255, Math.pow(b / 255, factor) * 255, 255];\n      },\n      negative: function negative(r, g, b) {\n        return [255 - r, 255 - g, 255 - b, 255];\n      },\n      noGreen: function noGreen(r, g, b) {\n        return [r, 0, b, 255];\n      },\n      maxGreen: function maxGreen(r, g, b) {\n        return [r, 255, b, 255];\n      },\n      onlyGreen: function onlyGreen(r, g) {\n        return [0, g, 0, 255];\n      },\n      maxAllButGreen: function maxAllButGreen(r, g) {\n        return [255, g, 255, 255];\n      },\n      brightness: function brightness(r, g, b, a, factor) {\n        // factor: '(0-255)'\n        return [r + factor, g + factor, b + factor, 255];\n      },\n      noise: function noise(r, g, b, a, factor) {\n        //   factor: '(0 - 500+)'\n        if (r != 0 && g != 0 && b != 0 && a != 0) {\n          var rand = (0.5 - Math.random()) * factor;\n          return [r + rand, g + rand, b + rand, 255];\n        }\n        return [r, g, b, a];\n      },\n      randomClear: function randomClear(r, g, b, a, factor) {\n        if (r != 0 && g != 0 && b != 0 && a != 0) {\n          if (Math.random() < factor) {\n            r = g = b = a = undefined;\n          }\n        }\n\n        return [r, g, b, a];\n      }\n    },\n\n    Convolver: {\n      smean_removal_sharpen: {\n        name: 'mean removal (sharpen)',\n        data: [[-1, -1, -1], [-1, 9, -1], [-1, -1, -1]]\n      },\n      sharpen: {\n        name: 'sharpen',\n        data: [[0, -2, 0], [-2, 11, -2], [0, -2, 0]]\n      },\n      blur: {\n        name: 'blur',\n        data: [[1, 2, 1], [2, 4, 2], [1, 2, 1]]\n      },\n      emboss: {\n        name: 'emboss',\n        data: [[2, 0, 0], [0, -1, 0], [0, 0, -1]],\n        offset: 127\n      },\n      emboss_subtle: {\n        name: 'emboss subtle',\n        data: [[1, 1, -1], [1, 3, -1], [1, -1, -1]]\n      },\n      edge_detect: {\n        name: 'edge detect',\n        data: [[1, 1, 1], [1, -7, 1], [1, 1, 1]]\n      },\n      edge_detect_2: {\n        name: 'edge detect 2',\n        data: [[-5, 0, 0], [0, 0, 0], [0, 0, 5]]\n      }\n    }\n  });\n})(cEngine);\n},{}]},{},[1])"],"sourceRoot":"/source/"}